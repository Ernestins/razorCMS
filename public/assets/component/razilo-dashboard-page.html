<!--
* raziloComponents
* razilo-dashboard-page - Simple single page demo app start point
* @author Paul Smith (smiffy6969)
* @site component.razilo.net
* @licence MIT
-->

<!-- DEPENDANCIES -->
<link rel="import" href="razilocomponents/index.html" />

<!-- STYLE - Encapsulate all css to tag name -->
<style>
	razilo-dashboard-page { margin: 0; padding: 0; }
	razilo-dashboard-page razilo-accordian { background-color: #f4f4f4; color: #444; }
	/* razilo-dashboard-page razilo-accordian main .left { width: 50%; height: 200px; } */
	razilo-dashboard-page razilo-accordian main .left { display: inline-block; width: 50%; }
	razilo-dashboard-page razilo-accordian main .right { display: inline-block; width: 48%; float: right; }
	razilo-dashboard-page razilo-accordian main .delete-page { float: right; }
</style>

<!-- TEMPLATE -->
<template id="razilo-dashboard-page">
	<div class="dashboard-pane">
		<razilo-accordian bind-for="private.pages" class="fff">
			<heading>
				<span bind-text="$value.name"></span>
				<razilo-tag bind-show="$value.active" size="small" shape="rounded" color="green">active</razilo-tag>
			</heading>
			<main>
				<div class="line">
					<div class="left">
						<table is="razilo-table">
							<thead>
								<tr>
									<th>Name</th>
									<th>Value</th>
								</tr>
							</thead>
							<tbody>
								<tr bind-for="$value">
									<td bind-text="$key"></td>
									<td bind-text="$value"></td>
								</tr>
							</tbody>
						</table>
					</div>
					<div class="right">
						<p>snapshot here</p>
					</div>
					<button is="razilo-button" class="booo" color="blue" size="medium" bind-click="editPage($value)">Edit Page</button>
					<button is="razilo-button" color="orange" size="medium" bind-click="makeHomePage($value)">Make Home Page</button>
					<button is="razilo-button" class="delete-page" color="red" size="medium" bind-click="deletePage($value, $key)">Delete Page</button>
				</div>

			</main>
		</razilo-accordian>
	</div>
</template>

<!-- LOGIC -->
<script>
	new RaziloComponent('razilo-dashboard-page', {
		private: {
			pages: null
		},

		/**
		 * Attached
		 */
		attached: function() {
			this.getPages();
		},

		/**
		 * showLogin
		 */
		getPages: function() {
			document.querySelector('razilo-admin razilo-request').get('page').then((res) => {
				this.private.pages = res.data.data;
			}).catch((error) => {
				console.log(error);
				// document.querySelector('razilo-admin razilo-message').setIcon('exclamation-triangle').setColor('red').setMessage(error.data.message).show();
			});
		},

		/**
		 * showLogin
		 */
		editPage: function(event, page) {
			if (!page) return;
			// var link = page.link.length > 0 ? page.link : '/';
			// window.location.href = link;
		},

		/**
		 * showLogin
		 */
		makeHomePage: function(event, page) {
			console.log('home', page);
			// document.querySelector('razilo-admin razilo-request').get('page').then((res) => {
			// 	this.private.pages = res.data.data;
			// }).catch((error) => {
			// 	document.querySelector('razilo-admin razilo-message').setIcon('exclamation-triangle').setColor('red').setMessage(error.data.message).show();
			// });
		},

		/**
		 * showLogin
		 */
		deletePage: function(event, page, idx) {
			console.log('delete', page);
			document.querySelector('razilo-admin razilo-request').delete('page/' + page.id).then((res) => {
				this.private.pages.splice(idx, 1);
				console.log('ok', res);
				// document.querySelector('razilo-admin razilo-message').setIcon('check').setColor('green').setMessage(res.data.message).show();
			}).catch((error) => {
				console.log('error', error);
				// document.querySelector('razilo-admin razilo-message').setIcon('exclamation-triangle').setColor('red').setMessage(error.data.message).show();
			});
		}
	});
</script>
