<!-- import and vulc --><!-- <link rel="import" href="./employee/employee-list.html"> --><!-- import only from public --><html><head><meta charset="UTF-8"><!-- https://elements.polymer-project.org/bower_components/iron-icons/demo/index.html -->
<!-- import from app (vulcable) -->
</head><body><div hidden="" by-vulcanize=""><link rel="import" href="/components/paper-button/paper-button.html"><link rel="import" href="/components/paper-input/paper-input.html"><link rel="import" href="/components/paper-dialog/paper-dialog.html"><link rel="import" href="/components/paper-dialog-scrollable/paper-dialog-scrollable.html"><link rel="import" href="/components/paper-toast/paper-toast.html"><link rel="import" href="/components/iron-icons/iron-icons.html"><link rel="import" href="/components/iron-icons/maps-icons.html"><link rel="import" href="/components/neon-animation/neon-animation.html"><link rel="import" href="/components/neon-animation/web-animations.html"><link rel="import" href="/components/razilocomponents/razilo-request.html"><link rel="import" href="/components/razilocomponents/razilo-store.html"><dom-module id="razilo-style-base" assetpath="./">
	<template>
		<style>
			* { font-family: sans-serif; }
			paper-item { color: #444; cursor: pointer; }

			.green, [color="green"] { background: green; color: white; }
			.green[disabled], [color="green"][disabled] { background: green; color: white; opacity: 0.6; }
			.red, [color="red"] { background: red; color: white; }
			.red[disabled], [color="red"][disabled] { background: red; color: white; opacity: 0.6; }
			.orange, [color="orange"] { background: orange; color: white; }
			.orange[disabled], [color="orange"][disabled] { background: orange; color: white; opacity: 0.6; }
			.black, [color="black"] { background: black; color: white; }
			.black[disabled], [color="black"][disabled] { background: black; color: white; opacity: 0.6; }
			.grey, [color="grey"] { background: grey; color: black; }
			.grey[disabled], [color="grey"][disabled] { background: grey; color: black; opacity: 0.6; }
		</style>
	</template>
</dom-module>
<link rel="import" href="/components/iron-icons/editor-icons.html"><link rel="import" href="/components/iron-icons/image-icons.html"><style>
	/* Put this inside a style module, create system style and import into each bit of the system */
	* { font-family: sans-serif; }
</style><dom-module id="razilo-panel" assetpath="./">
	<template>
		<style include="razilo-style-base">
			:host { margin: 0; padding: 5px; position: fixed; top: 3px; left: 3px; z-index: 100; background-color: #f4f4f4; border: 1px solid #eee; box-shadow: 0px 0px 30px 0px; transform-origin: 12px 12px; -webkit-transition: transform 0.5s ease-in-out; -moz-transition: transform 0.5s ease-in-out; -ms-transition: transform 0.5s ease-in-out; transition: transform 0.5s ease-in-out; }
			:host([rotate]) { transform: rotate(180deg); }
			.dashboard-controls .rotate { cursor: pointer; position: absolute; top: 5px; left: 5px; width: 15px; height: 15px; }
			.dashboard-controls .details { padding-left: 20px; float: right; text-align: right; }
			.dashboard-controls .details .name .profile { cursor: pointer; }
			.dashboard-controls .details .last-logged-in { font-size: 8px; }
			.dashboard-controls .details .last-logged-in .history { height: 10px; width: 10px; }
			.editor-controls { float: left; }
			.editor-controls iron-icon { cursor: pointer; margin: 0px 3px; }
		</style>

		<razilo-store id="store"></razilo-store>

		<div class="panel">
			<div class="dashboard-controls">
				<iron-icon class="rotate" icon="icons:cached" on-click="rotatePanel"></iron-icon>
				<div class="details">
					<div class="name">
						<span>{{user.name}}</span>
						<iron-icon class="profile" icon="icons:account-circle" on-click="doAction" action="profileEdit"></iron-icon>
					</div>
					<p class="last-logged-in">
						<iron-icon class="history" icon="icons:history"></iron-icon>
						{{dateFormat(user.last_logged_in)}}
					</p>
				</div>
			</div>

			<div class="editor-controls" bind-show="checkAccessLevel(private.user.access_level, 5)">
				<iron-icon icon="icons:settings" on-click="doAction" action="dashboard"></iron-icon>
				<iron-icon icon="editor:mode-edit" on-click="doAction" action="pageEdit"></iron-icon>
				<iron-icon icon="image:control-point" on-click="doAction" action="pageAdd"></iron-icon>
				<iron-icon icon="image:control-point-duplicate" on-click="doAction" action="pageCopy"></iron-icon>
			</div>
		</div>
	</template>

	<script>
		class RaziloPanel extends Polymer.Element {
			static get is() { return "razilo-panel"; }

			static get properties() {
				return {
					action: { type: String, value: null },
					rotate: { type: Boolean, value: false },
					user: { type: Object, value: null }
				}
			}

			constructor() {
				super();
			}

			ready() {
				super.ready();

				this.rotate = this.$.store.getItem('panel.rotate');
				if (this.rotate) this.setAttribute('rotate', '');
				else this.removeAttribute('rotate');
			}

			rotatePanel() {
				this.rotate = !this.rotate;
				if (this.rotate) this.setAttribute('rotate', '');
				else this.removeAttribute('rotate');

				this.$.store.setItem('panel.rotate', this.rotate);
			}

			doAction(event) {
				this.action = event.target.getAttribute('action');
				this.dispatchEvent(new CustomEvent('action', {detail: {action: this.action}}));
			}

			dateFormat(time) {
				var date = new Date(time);
				return date.toDateString();
			}
		}

		customElements.define(RaziloPanel.is, RaziloPanel);
	</script>
</dom-module>
<!-- <link rel="import" href="/components/paper-toast/paper-toast.html"> -->
<!-- <link rel="import" href="/components/iron-icons/iron-icons.html"> -->
<!-- <link rel="import" href="/components/iron-icons/editor-icons.html"> -->
<!-- <link rel="import" href="/components/iron-icons/image-icons.html"> -->
<!-- <link rel="import" href="/components/iron-icons/maps-icons.html"> -->

<!-- <link rel="import" href="/components/razilocomponents/razilo-request.html"> -->
<!-- <link rel="import" href="/components/razilocomponents/razilo-store.html"> -->

<link rel="import" href="/components/paper-tabs/paper-tabs.html"><dom-module id="razilo-dashboard-detail" assetpath="Dashboard/">
	<template>
		<style include="razilo-style-base">
			.save { float: right; }
		</style>

		<razilo-request id="request" base-url="razorcms.docker.localhost/api"></razilo-request>
		<paper-toast id="toast" color$="{{toastColor}}"></paper-toast>

		<paper-dropdown-menu label="Access Level">
			<paper-listbox slot="dropdown-content" selected="{{page.access_level}}">
				<paper-item value="0">Public</paper-item>
				<paper-item value="1">User Level 1</paper-item>
				<paper-item value="2">User Level 2</paper-item>
				<paper-item value="3">User Level 3</paper-item>
				<paper-item value="4">User Level 4</paper-item>
				<paper-item value="5">User Level 5</paper-item>
			</paper-listbox>
		</paper-dropdown-menu>
		<paper-input label="Name (used in menus)" type="text" value="{{page.name}}" invalid="{{inv.name}}" required="" auto-validate="" error-message="Needs some text!"></paper-input>
		<paper-input label="Title (used by search engines)" type="text" value="{{page.title}}" invalid="{{inv.title}}" required="" auto-validate="" error-message="Needs some text!"></paper-input>
		<paper-input label="Link (to access page from browser)" type="text" value="{{page.link}}" invalid="{{inv.link}}"></paper-input>
		<paper-input label="Keywords (used by search engines, comma seperated)" type="text" value="{{page.keywords}}" invalid="{{inv.key}}" required="" auto-validate="" error-message="Needs some text!"></paper-input>
		<paper-textarea label="Description (used by search engines)" max-rows="2" invalid="{{inv.desc}}" required="" auto-validate="" error-message="Needs some text!" value="{{page.description}}"></paper-textarea>
		<paper-button dialog-confirm="" autofocus="" class="save" on-click="doSave" color="green" disabled$="{{isInvalid(inv.name, inv.title, inv.link, inv.key, inv.desc)}}">Save</paper-button>
	</template>

	<script>
		class RaziloDashboardDetail extends Polymer.Element {
			static get is() { return "razilo-dashboard-detail"; }

			static get properties() {
				return {
					currentPage: { type: Number, value: null },
					opened: { type: Boolean, value: false }
				}
			}

			constructor() {
				super();

				this.page = {};
				this.inv = {};
			}

			ready() {
				super.ready();

				this.getPage();
			}

			open() {
				this.opened = true;
			}

			close() {
				this.opened = false;
			}

	   		getPage() {
				this.$.request.get('page', this.currentPage).then((res) => {
					this.page = res.data.data;
				}).catch((error) => {
					this.toast(error.data.message, 'red');
				});
	   		}

			doSave() {
				this.$.request.patch('page/' + this.currentPage, this.page).then((res) => {
					this.page = res.data.data;
					this.toast(res.data.message, 'green');
				}).catch((error) => {
					this.toast(error.data.message, 'red');
				});
			}

			isInvalid(invName, invTitle, invLink, invKey, invDesc) {
				return invName || invTitle || invLink || invKey || invDesc;
			}

			toast(text, color) {
				if (color) this.toastColor = color;
				this.$.toast.text = text;
				this.$.toast.open();
			}
		}

		customElements.define(RaziloDashboardDetail.is, RaziloDashboardDetail);
	</script>
</dom-module>
<link rel="import" href="/components/paper-item/paper-item.html"><dom-module id="razilo-dashboard-page" assetpath="Dashboard/">
	<template>
		<style include="razilo-style-base">
			paper-item { margin-bottom: 10px; color: white; }
			paper-item:hover { background-color: #111; }
			iron-icon { margin-right: 20px; color: white; }
			iron-icon.active { color: green; }
			iron-icon.inactive { color: red; }
		</style>

		<razilo-request id="request" base-url="razorcms.docker.localhost/api"></razilo-request>
		<paper-toast id="toast" color$="{{toastColor}}"></paper-toast>

		<template is="dom-repeat" items="{{pages}}" index-as="id">
			<paper-item>
				<iron-icon class="active" icon="icons:check" hidden$="{{!numberTrue(item.active)}}"></iron-icon>
				<iron-icon class="inactive" icon="icons:block" hidden$="{{numberTrue(item.active)}}"></iron-icon>
				<paper-item-body two-line="">
					<div>{{item.name}}</div>
					<div secondary="">{{item.title}}</div>
				</paper-item-body>
			</paper-item>
		</template>


		<!-- <razilo-accordian bind-for="private.pages" class="fff">
			<heading>
				<span bind-text="$value.name"></span>
				<razilo-tag bind-show="$value.active" size="small" shape="rounded" color="green">active</razilo-tag>
			</heading>
			<main>
				<div class="line">
					<div class="left">
						<table is="razilo-table">
							<thead>
								<tr>
									<th>Name</th>
									<th>Value</th>
								</tr>
							</thead>
							<tbody>
								<tr bind-for="$value">
									<td bind-text="$key"></td>
									<td bind-text="$value"></td>
								</tr>
							</tbody>
						</table>
					</div>
					<div class="right">
						<p>snapshot here</p>
					</div>
					<button is="razilo-button" class="booo" color="blue" size="medium" bind-click="editPage($value)">Edit Page</button>
					<button is="razilo-button" color="orange" size="medium" bind-click="makeHomePage($value)">Make Home Page</button>
					<button is="razilo-button" class="delete-page" color="red" size="medium" bind-click="deletePage($value, $key)">Delete Page</button>
				</div>

			</main>
		</razilo-accordian> -->

	</template>

	<script>
		class RaziloDashboardPage extends Polymer.Element {
			static get is() { return "razilo-dashboard-page"; }

			static get properties() {
				return {
					opened: { type: Boolean, value: false }
				}
			}

			constructor() {
				super();

				this.pages = [];
			}

			ready() {
				super.ready();
				this.getPages();
			}

			open() {
				this.opened = true;
			}

			close() {
				this.opened = false;
			}

			getPages() {
				this.$.request.get('page').then((res) => {
					this.pages = res.data.data;
				}).catch((error) => {
					this.toast(error.data.message, 'red');
				});
			}

			numberTrue(a) {
				return parseInt(a) == 0 ? false : true;
			}

			doSave() {
				// this.$.request.put('page/' + this.currentPage, this.page).then((res) => {
				// 	this.getPage();
				// 	this.toast(res.data.message, 'green');
				// }).catch((error) => {
				// 	this.toast(error.data.message, 'red');
				// });
			}

			toast(text, color) {
				if (color) this.toastColor = color;
				this.$.toast.text = text;
				this.$.toast.open();
			}



			// private: {
			// 	pages: null
			// },
            //
			// /**
			//  * Attached
			//  */
			// attached: function() {
			// 	this.getPages();
			// },
            //
			// /**
			//  * showLogin
			//  */
			// getPages: function() {
			// 	document.querySelector('razilo-admin razilo-request').get('page').then((res) => {
			// 		this.private.pages = res.data.data;
			// 	}).catch((error) => {
			// 		console.log(error);
			// 		// document.querySelector('razilo-admin razilo-message').setIcon('exclamation-triangle').setColor('red').setMessage(error.data.message).show();
			// 	});
			// },
            //
			// /**
			//  * showLogin
			//  */
			// editPage: function(event, page) {
			// 	if (!page) return;
			// 	// var link = page.link.length > 0 ? page.link : '/';
			// 	// window.location.href = link;
			// },
            //
			// /**
			//  * showLogin
			//  */
			// makeHomePage: function(event, page) {
			// 	console.log('home', page);
			// 	// document.querySelector('razilo-admin razilo-request').get('page').then((res) => {
			// 	// 	this.private.pages = res.data.data;
			// 	// }).catch((error) => {
			// 	// 	document.querySelector('razilo-admin razilo-message').setIcon('exclamation-triangle').setColor('red').setMessage(error.data.message).show();
			// 	// });
			// },
            //
			// /**
			//  * showLogin
			//  */
			// deletePage: function(event, page, idx) {
			// 	console.log('delete', page);
			// 	document.querySelector('razilo-admin razilo-request').delete('page/' + page.id).then((res) => {
			// 		this.private.pages.splice(idx, 1);
			// 		console.log('ok', res);
			// 		// document.querySelector('razilo-admin razilo-message').setIcon('check').setColor('green').setMessage(res.data.message).show();
			// 	}).catch((error) => {
			// 		console.log('error', error);
			// 		// document.querySelector('razilo-admin razilo-message').setIcon('exclamation-triangle').setColor('red').setMessage(error.data.message).show();
			// 	});
			// }


		}

		customElements.define(RaziloDashboardPage.is, RaziloDashboardPage);
	</script>
</dom-module>
<dom-module id="razilo-dashboard-content" assetpath="Dashboard/">
	<template>
		<style include="razilo-style-base">
		</style>

		<razilo-request id="request" base-url="razorcms.docker.localhost/api"></razilo-request>
		<paper-toast id="toast" color$="{{toastColor}}"></paper-toast>

		<p>Content</p>

	</template>

	<script>
		class RaziloDashboardContent extends Polymer.Element {
			static get is() { return "razilo-dashboard-content"; }

			static get properties() {
				return {
					opened: { type: Boolean, value: false }
				}
			}

			constructor() {
				super();

				this.page = {};
			}

			ready() {
				super.ready();
			}

			open() {
				this.opened = true;
			}

			close() {
				this.opened = false;
			}

			doSave() {
				// this.$.request.put('page/' + this.currentPage, this.page).then((res) => {
				// 	this.getPage();
				// 	this.toast(res.data.message, 'green');
				// }).catch((error) => {
				// 	this.toast(error.data.message, 'red');
				// });
			}

			toast(text, color) {
				if (color) this.toastColor = color;
				this.$.toast.text = text;
				this.$.toast.open();
			}
		}

		customElements.define(RaziloDashboardContent.is, RaziloDashboardContent);
	</script>
</dom-module>
<dom-module id="razilo-dashboard-extension" assetpath="Dashboard/">
	<template>
		<style include="razilo-style-base">
		</style>

		<razilo-request id="request" base-url="razorcms.docker.localhost/api"></razilo-request>
		<paper-toast id="toast" color$="{{toastColor}}"></paper-toast>

		<p>Extension</p>

	</template>

	<script>
		class RaziloDashboardExtension extends Polymer.Element {
			static get is() { return "razilo-dashboard-extension"; }

			static get properties() {
				return {
					opened: { type: Boolean, value: false }
				}
			}

			constructor() {
				super();

				this.page = {};
			}

			ready() {
				super.ready();
			}

			open() {
				this.opened = true;
			}

			close() {
				this.opened = false;
			}

			doSave() {
				// this.$.request.put('page/' + this.currentPage, this.page).then((res) => {
				// 	this.getPage();
				// 	this.toast(res.data.message, 'green');
				// }).catch((error) => {
				// 	this.toast(error.data.message, 'red');
				// });
			}

			toast(text, color) {
				if (color) this.toastColor = color;
				this.$.toast.text = text;
				this.$.toast.open();
			}
		}

		customElements.define(RaziloDashboardExtension.is, RaziloDashboardExtension);
	</script>
</dom-module>
<dom-module id="razilo-dashboard-user" assetpath="Dashboard/">
	<template>
		<style include="razilo-style-base">

		</style>

		<razilo-request id="request" base-url="razorcms.docker.localhost/api"></razilo-request>
		<paper-toast id="toast" color$="{{toastColor}}"></paper-toast>

		<p>User</p>

	</template>

	<script>
		class RaziloDashboardUser extends Polymer.Element {
			static get is() { return "razilo-dashboard-user"; }

			static get properties() {
				return {
					opened: { type: Boolean, value: false }
				}
			}

			constructor() {
				super();

				this.page = {};
			}

			ready() {
				super.ready();
			}

			open() {
				this.opened = true;
			}

			close() {
				this.opened = false;
			}

			doSave() {
				// this.$.request.put('page/' + this.currentPage, this.page).then((res) => {
				// 	this.getPage();
				// 	this.toast(res.data.message, 'green');
				// }).catch((error) => {
				// 	this.toast(error.data.message, 'red');
				// });
			}

			toast(text, color) {
				if (color) this.toastColor = color;
				this.$.toast.text = text;
				this.$.toast.open();
			}
		}

		customElements.define(RaziloDashboardUser.is, RaziloDashboardUser);
	</script>
</dom-module>
<dom-module id="razilo-dashboard-setting" assetpath="Dashboard/">
	<template>
		<style include="razilo-style-base">
		</style>

		<razilo-request id="request" base-url="razorcms.docker.localhost/api"></razilo-request>
		<paper-toast id="toast" color$="{{toastColor}}"></paper-toast>

		<p>Setting</p>

	</template>

	<script>
		class RaziloDashboardSetting extends Polymer.Element {
			static get is() { return "razilo-dashboard-setting"; }

			static get properties() {
				return {
					opened: { type: Boolean, value: false }
				}
			}

			constructor() {
				super();

				this.page = {};
			}

			ready() {
				super.ready();
			}

			open() {
				this.opened = true;
			}

			close() {
				this.opened = false;
			}

			doSave() {
				// this.$.request.put('page/' + this.currentPage, this.page).then((res) => {
				// 	this.getPage();
				// 	this.toast(res.data.message, 'green');
				// }).catch((error) => {
				// 	this.toast(error.data.message, 'red');
				// });
			}

			toast(text, color) {
				if (color) this.toastColor = color;
				this.$.toast.text = text;
				this.$.toast.open();
			}
		}

		customElements.define(RaziloDashboardSetting.is, RaziloDashboardSetting);
	</script>
</dom-module>
<dom-module id="razilo-dashboard" assetpath="Dashboard/">
	<template>
		<style include="razilo-style-base">
			* { color: white; --primary-text-color: white; }

			:host {
				position: fixed;
				display: none;
			    width: 1px;
			    height: 1px;
			    z-index: -1;
			    background-color: black;
			    opacity: 0.95;
			}

			:host([opened]) {
				display: block;
				position: fixed;
			    width: 100%;
			    height: 100%;
			    z-index: 101;
			}

			paper-tabs { margin-top: 0; margin-bottom: 0; --paper-tabs-selection-bar-color: white; }
			paper-tab { color: white; }
			.sheet { padding: 20px; overflow: auto; box-sizing: border-box; }
		</style>

		<div id="container">
			<paper-tabs id="tabs" selected="{{tab}}">
				<paper-tab>Detail</paper-tab>
				<paper-tab>Pages</paper-tab>
				<paper-tab>Content</paper-tab>
				<paper-tab>Extensions</paper-tab>
				<paper-tab>Users</paper-tab>
				<paper-tab>Settings</paper-tab>
				<paper-tab on-click="close">X</paper-tab>
			</paper-tabs>
			<div id="sheet" class="sheet">
				<razilo-dashboard-detail current-page="{{currentPage}}" hidden$="{{different(tab, 0)}}"></razilo-dashboard-detail>
				<razilo-dashboard-page hidden$="{{different(tab, 1)}}"></razilo-dashboard-page>
				<razilo-dashboard-content hidden$="{{different(tab, 2)}}"></razilo-dashboard-content>
				<razilo-dashboard-extension hidden$="{{different(tab, 3)}}"></razilo-dashboard-extension>
				<razilo-dashboard-user hidden$="{{different(tab, 4)}}"></razilo-dashboard-user>
				<razilo-dashboard-setting hidden$="{{different(tab, 5)}}"></razilo-dashboard-setting>
			</div>
		</div>
	</template>

	<script>
		class RaziloDashboard extends Polymer.Element {
			static get is() { return "razilo-dashboard"; }

			static get properties() {
				return {
					currentPage: { type: String, value: null },
					opened: { type: Boolean, value: false },
					tab: { type: Number, value: 0 }
				}
			}

			constructor() {
				super();

				this.bodyOverflow = document.body.style.overflow;
			}

			ready() {
				super.ready();
			}

			open() {
				this.opened = true;
				this.setAttribute('opened', '');
				this.resize();
				this.tab = 0;
				document.body.style.overflow = 'hidden';
			}

			close() {
				this.opened = false;
				this.removeAttribute('opened');
				document.body.style.overflow = this.bodyOverflow;
			}

			resize() {
				this.$.sheet.style.height = window.innerHeight - this.$.tabs.offsetHeight + 'px';
			}

			different(a, b) {
				return a != b;
			}

			doSave() {
				consoel.log('save');
			}
		}

		customElements.define(RaziloDashboard.is, RaziloDashboard);
	</script>
</dom-module>
<dom-module id="razilo-profile-edit" assetpath="Profile/">
	<template>
		<style include="razilo-style-base"></style>

		<razilo-request id="request" base-url="razorcms.docker.localhost/api"></razilo-request>
		<razilo-store id="store"></razilo-store>
		<paper-toast id="toast" color$="{{toastColor}}"></paper-toast>

		<paper-dialog id="loginModal" class="modal" opened="{{opened}}" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
			<h2>Change Your Profile</h2>
			<paper-dialog-scrollable>
				<paper-input label="Name" type="text" value="{{user.name}}" invalid="{{invName}}" required="" auto-validate="" error-message="Needs some text!"></paper-input>
				<paper-input label="Email" type="email" value="{{user.email_address}}" invalid="{{invEmail}}" required="" auto-validate="" error-message="Needs a valid email!"></paper-input>
				<paper-input label="Password" type="password" value="{{password}}"></paper-input>
				<paper-input label="Repeat Password" type="password" value="{{passwordRepeat}}" invalid="{{isDifferent(password, passwordRepeat)}}" error-message="Must match password"></paper-input>
			</paper-dialog-scrollable>
			<div class="buttons">
				<paper-button dialog-dismiss="">Cancel</paper-button>
				<paper-button dialog-confirm="" autofocus="" on-click="doSave" color="green" disabled$="{{isInvalid(invName, invEmail, password, passwordRepeat)}}">Save</paper-button>
			</div>
		</paper-dialog>
	</template>

	<script>
		class RaziloProfileEdit extends Polymer.Element {
			static get is() { return "razilo-profile-edit"; }

			static get properties() {
				return {
					opened: { type: Boolean, value: false },
					user: { type: Object, value: null }
				}
			}

			constructor() {
				super();

				this.form = null;
				this.password = null;
				this.passwordRepeat = null;
			}

			ready() {
				super.ready();
			}

			open() {
				this.opened = true;
			}

			close() {
				this.opened = false;
			}

			isInvalid(name, email, pass, passr) {
				return name || email || (!!pass && pass != passr);
			}

			isDifferent(pass, passr) {
				return !!pass && pass != passr;
			}

			doSave() {
				// create temp var to stop passwords being passed around
				var data = {
					name: this.user.name,
					email_address: this.user.email_address,
					new_password: this.password,
					repeat_password: this.passwordRepeat
				};

				this.$.request.post('user/update', data).then((res) => {
					this.password = null;
					this.passwordRepeat = null;
					this.$.store.setItem('user', res.data.data);
					this.toast(res.data.message, 'green');
					this.opened = false;
				}).catch((error) => {
					this.toast(error.data.message, 'red');
				});
			}

			toast(text, color) {
				if (color) this.toastColor = color;
				this.$.toast.text = text;
				this.$.toast.open();
			}
		}

		customElements.define(RaziloProfileEdit.is, RaziloProfileEdit);
	</script>
</dom-module>
<link rel="import" href="/components/paper-input/paper-textarea.html"><link rel="import" href="/components/paper-dropdown-menu/paper-dropdown-menu.html"><link rel="import" href="/components/paper-listbox/paper-listbox.html"><dom-module id="razilo-page-add" assetpath="Page/">
	<template>
		<style include="razilo-style-base">
			.modal { width: 500px; }
			paper-item { cursor: pointer; }
		</style>

		<razilo-request id="request" base-url="razorcms.docker.localhost/api"></razilo-request>
		<paper-toast id="toast" color$="{{toastColor}}"></paper-toast>

		<paper-dialog id="loginModal" class="modal" opened="{{opened}}" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
			<h2>Add a Page</h2>
			<paper-dialog-scrollable>
				<paper-dropdown-menu label="Access Level">
				  <paper-listbox slot="dropdown-content" selected="{{page.access_level}}">
				    <paper-item value="0">Public</paper-item>
				    <paper-item value="1">User Level 1</paper-item>
				    <paper-item value="2">User Level 2</paper-item>
				    <paper-item value="3">User Level 3</paper-item>
				    <paper-item value="4">User Level 4</paper-item>
				    <paper-item value="5">User Level 5</paper-item>
				  </paper-listbox>
				</paper-dropdown-menu>
				<paper-input label="Name (used in menus)" type="text" value="{{page.name}}" invalid="{{inv.name}}" required="" auto-validate="" error-message="Needs some text!"></paper-input>
				<paper-input label="Title (used by search engines)" type="text" value="{{page.title}}" invalid="{{inv.title}}" required="" auto-validate="" error-message="Needs some text!"></paper-input>
				<paper-input label="Link (to access page from browser)" type="text" value="{{page.link}}" invalid="{{inv.link}}"></paper-input>
				<paper-input label="Keywords (used by search engines, comma seperated)" type="text" value="{{page.keywords}}" invalid="{{inv.key}}" required="" auto-validate="" error-message="Needs some text!"></paper-input>
				<paper-textarea label="Description (used by search engines)" max-rows="2" invalid="{{inv.desc}}" required="" auto-validate="" error-message="Needs some text!" value="{{page.description}}"></paper-textarea>
			</paper-dialog-scrollable>
			<div class="buttons">
				<paper-button dialog-dismiss="" on-click="clearForm">Cancel</paper-button>
				<paper-button dialog-confirm="" autofocus="" on-click="doSave" color="green" disabled$="{{isInvalid(page.name, page.title, inv.link, page.keywords, page.description)}}">Save</paper-button>
			</div>
		</paper-dialog>
	</template>

	<script>
		class RaziloPageAdd extends Polymer.Element {
			static get is() { return "razilo-page-add"; }

			static get properties() {
				return {
					opened: { type: Boolean, value: false }
				}
			}

			constructor() {
				super();

				this.clearForm();
			}

			ready() {
				super.ready();
			}

			open() {
				this.opened = true;
			}

			close() {
				this.opened = false;
			}

			doSave() {
				this.$.request.put('page', this.page).then((res) => {
					this.clearForm();
					this.toast(res.data.message, 'green');
				}).catch((error) => {
					this.toast(error.data.message, 'red');
				});
			}

			isInvalid(name, title, invLink, keywords, description) {
				return !name || !title || invLink || !keywords || !description;
			}

			clearForm() {
				this.page = { 'access_level': 0 };
				this.inv = {};
			}

			toast(text, color) {
				if (color) this.toastColor = color;
				this.$.toast.text = text;
				this.$.toast.open();
			}
		}

		customElements.define(RaziloPageAdd.is, RaziloPageAdd);
	</script>
</dom-module>
<dom-module id="razilo-page-copy" assetpath="Page/">
	<template>
		<style include="razilo-style-base">
			.modal { width: 500px; }
			paper-item { cursor: pointer; }
		</style>

		<razilo-request id="request" base-url="razorcms.docker.localhost/api"></razilo-request>
		<paper-toast id="toast" color$="{{toastColor}}"></paper-toast>

		<paper-dialog id="loginModal" class="modal" opened="{{opened}}" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
			<h2>Copy This Page</h2>
			<paper-dialog-scrollable>
				<paper-dropdown-menu label="Access Level">
				  <paper-listbox slot="dropdown-content" selected="{{page.access_level}}">
				    <paper-item value="0">Public</paper-item>
				    <paper-item value="1">User Level 1</paper-item>
				    <paper-item value="2">User Level 2</paper-item>
				    <paper-item value="3">User Level 3</paper-item>
				    <paper-item value="4">User Level 4</paper-item>
				    <paper-item value="5">User Level 5</paper-item>
				  </paper-listbox>
				</paper-dropdown-menu>
				<paper-input label="Name (used in menus)" type="text" value="{{page.name}}" invalid="{{inv.name}}" required="" auto-validate="" error-message="Needs some text!"></paper-input>
				<paper-input label="Title (used by search engines)" type="text" value="{{page.title}}" invalid="{{inv.title}}" required="" auto-validate="" error-message="Needs some text!"></paper-input>
				<paper-input label="Link (to access page from browser)" type="text" value="{{page.link}}" invalid="{{inv.link}}"></paper-input>
				<paper-input label="Keywords (used by search engines, comma seperated)" type="text" value="{{page.keywords}}" invalid="{{inv.key}}" required="" auto-validate="" error-message="Needs some text!"></paper-input>
				<paper-textarea label="Description (used by search engines)" max-rows="2" invalid="{{inv.desc}}" required="" auto-validate="" error-message="Needs some text!" value="{{page.description}}"></paper-textarea>
			</paper-dialog-scrollable>
			<div class="buttons">
				<paper-button dialog-dismiss="" on-click="getPage">Cancel</paper-button>
				<paper-button dialog-confirm="" autofocus="" on-click="doSave" color="green" disabled$="{{isInvalid(page.name, page.title, inv.link, page.keywords, page.description)}}">Save</paper-button>
			</div>
		</paper-dialog>
	</template>

	<script>
		class RaziloPageCopy extends Polymer.Element {
			static get is() { return "razilo-page-copy"; }

			static get properties() {
				return {
					opened: { type: Boolean, value: false },
					currentPage: { type: Number, value: null }
				}
			}

			constructor() {
				super();

				this.page = {};
			}

			ready() {
				super.ready();

				this.getPage();
			}

			open() {
				this.opened = true;
			}

			close() {
				this.opened = false;
			}

	   		getPage() {
				this.$.request.get('page', this.currentPage).then((res) => {
					this.page = res.data.data;
				}).catch((error) => {
					this.toast(error.data.message, 'red');
				});
	   		}

			doSave() {
				this.$.request.put('page/' + this.currentPage, this.page).then((res) => {
					this.getPage();
					this.toast(res.data.message, 'green');
				}).catch((error) => {
					this.toast(error.data.message, 'red');
				});
			}

			isInvalid(name, title, invLink, keywords, description) {
				return !name || !title || invLink || !keywords || !description;
			}

			toast(text, color) {
				if (color) this.toastColor = color;
				this.$.toast.text = text;
				this.$.toast.open();
			}
		}

		customElements.define(RaziloPageCopy.is, RaziloPageCopy);
	</script>
</dom-module>
<style>
	/* Put this inside a style module, create system style and import into each bit of the system */
	* { font-family: sans-serif; }
</style></div><dom-module id="razilo-app">
	<template>
		<style include="razilo-style-base">
			.modal .inputs { padding: 0 20px; }
		</style>

		<template id="restricted" is="dom-if" if="{{user}}">
			<razilo-panel user="{{user}}" on-action="doAction"></razilo-panel>
			<razilo-dashboard current-page="{{currentPage}}"></razilo-dashboard>
			<razilo-profile-edit user="{{user}}"></razilo-profile-edit>
			<razilo-page-add></razilo-page-add>
			<razilo-page-copy current-page="{{currentPage}}"></razilo-page-copy>
		</template>

		<razilo-request id="request" base-url="razorcms.docker.localhost/api"></razilo-request>
		<razilo-store id="store"></razilo-store>
		<paper-toast id="toast" color$="{{toastColor}}"></paper-toast>

		<paper-dialog id="loginModal" class="modal">
			<h2>Razilo Login</h2>
			<div class="inputs">
				<paper-input id="loginUsername" label="Email" type="text" on-keyup="doLogin"></paper-input>
				<paper-input id="loginPassword" label="Password" type="password" on-keyup="doLogin"></paper-input>
			</div>
			<div class="buttons">
				<paper-button dialog-dismiss="">Cancel</paper-button>
				<paper-button dialog-confirm="" autofocus="" on-click="doLogin" color="green">Log In</paper-button>
			</div>
		</paper-dialog>
	</template>

	<script>
		class RaziloApp extends Polymer.Element {
			static get is() { return "razilo-app"; }

			static get properties() {
				return {
					currentPath: { type: String, value: null },
					currentPage: { type: Number, value: null }
				}
			}

			constructor() {
				super();

				this.action = null;
				this.user = null;
				this.toastColor = null;
			}

			ready() {
				super.ready();

				if (this.currentPath == 'login') this.openLogin();
				else this.authenticate();
			}

			openLogin() {
				this.$.loginModal.open();
			}

			doLogin(event) {
				if (event.type == 'keyup' && event.keyCode != 13) return;

				this.$.request.post('login', {username: this.$.loginUsername.value, password: this.$.loginPassword.value}).then((res) => {
					this.$.loginPassword.value = '';
					this.$.store.setItem('user', res.data.data);
					this.user = res.data.data;
					location.href = location.href.replace('/login', '');
				}).catch((error) => {
					this.$.loginPassword.value = '';
					this.doLogout();
					this.toast(error.data.message, 'red');
				});
			}

			doLogout() {
				this.user = null;
				this.$.store.deleteItem('user');
				this.$.request.deleteToken();
			}

			doAction(event) {
				switch (event.detail.action) {
					case 'dashboard' : this.shadowRoot.querySelector('razilo-dashboard').open(); break;
					case 'profileEdit' : this.shadowRoot.querySelector('razilo-profile-edit').open(); break;
					case 'pageAdd' : this.shadowRoot.querySelector('razilo-page-add').open(); break;
					case 'pageCopy' : this.shadowRoot.querySelector('razilo-page-copy').open(); break;
				}
			}

			authenticate() {
				this.$.request.get('ping').then((res) => {
					this.user = this.$.store.getItem('user');
				}).catch((error) => {
					this.doLogout();
				});
			}

			toast(text, color) {
				if (color) this.toastColor = color;
				this.$.toast.text = text;
				this.$.toast.open();
			}
		}

		customElements.define(RaziloApp.is, RaziloApp);
	</script>
</dom-module>
</body></html>